<html>

<head>
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
	<link rel="stylesheet" href="/style.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Speak</title>
</head>

<body class="center text-center">
	<div class="card">
		<div class="card-title">
			<h4>Say Something to Me</h4>
		</div>
		<p>Any text entered here will be read out loud in real time by the Google Home in my apartment.</p>
		<div class="spacer"></div>
		<p>What could possibly go wrong?</p>
		<div class="spacer"></div>
		<form id="form">
			<input id="input" name="message" type="text" />
			<div id="errors"></div>
			<div class="spacer"></div>
			<button id="speak" class="btn" type="submit">Speak</Button>
			<div id="response" style="display: none">
				<div class="spacer"></div>
				<p class="text-success text-small">Sent!</p>
			</div>
		</form>
	</div>
	<script>
		const errors = document.getElementById('errors');
		const form = document.getElementById('form');
		const input = document.getElementById('input');
		const response = document.getElementById('response');
		const speak = document.getElementById('speak');
		const reset = () => {
			errors.innerHTML = '';
			response.style.display = 'none';
		};
		input.oninput = reset;
		form.onsubmit = (e) => {
			e.preventDefault();
			reset();
			speak.disabled = true;
			const req = new XMLHttpRequest();
			req.open('POST', '/api', true);
			req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
			req.onload = () => {
				const res = JSON.parse(req.responseText || '{}');
				if (!!res.errors) {
					res.errors.forEach(err => {
						errors.innerHTML += '<div class="spacer"></div>';
						errors.innerHTML += `<p class="text-error text-small">${ err }</p>`;
					});
				} else {
					response.style.display = 'block';
				}
				speak.disabled = false;
			}
			req.send(`message=${ input.value }`);
		};
	</script>
</body>

</html>
